<!DOCTYPE html>
<html>

<head>
    <title>Add Chapters</title>
</head>

<body>
    <main>
        <form id="addChapterForm" class="add_chapter" method="post">
            <label class="addchapter_label" for="title">Chapter Title:</label>
            <div class="multiple-input-container">
                <input type="text" id="chapterTitle" name="title" placeholder="Enter Chapter Title" required />
            </div>

            <label class="addchapter_label" for="content">Chapter Content:</label>
            <div class="description-textarea">
                <textarea id="chapterContent" name="content" rows="10" cols="80" required></textarea>
            </div>

            <button id="addChapterBtn" type="submit" class="add_chapter_btn">
                Add Chapter
            </button>
        </form>

        <div id="chaptersContainer">
            <!-- Chapter boxes will be dynamically added here -->
          </div>
<script src="/js/addchapters.js" type="module"></script>



    <!-- <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getDatabase, push, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

        //config code...........
        const firebaseConfig = {
            apiKey: "AIzaSyCiNLLV_8GXpvSD7IeVUfp4dbq-_pcvn7w",
            authDomain: "bookish-proj.firebaseapp.com",
            databaseURL: "https://bookish-proj-default-rtdb.firebaseio.com",
            projectId: "bookish-proj",
            storageBucket: "bookish-proj.appspot.com",
            messagingSenderId: "351432216616",
            appId: "1:351432216616:web:59c46450f373a82ad9251d",
            measurementId: "G-DH4RJ9TML1",
        };


        const app = initializeApp(firebaseConfig);

        const auth = getAuth(app);
        const db = getDatabase(app);

        // Function to handle form submission
        async function submitForm(event) {
            event.preventDefault();

            try {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        const email = user?.email;

                        const bookTitle = "Your_Book_Title";
                        const chapterTitle = document.getElementById("chapterTitle").value;
                        const chapterContent = document.getElementById("chapterContent").value;

                        const bookRef = ref(db, `books/${bookTitle}/chapters`);
                        const chapterRef = push(bookRef, {
                            username: email,
                            email: email,
                            bookTitle: bookTitle,
                            title: chapterTitle,
                            content: chapterContent,
                            timestamp: new Date().toLocaleString(),
                        });

                        console.log(chapterRef);

                        // Clear form fields after successful submission
                        document.getElementById("chapterTitle").value = "";
                        document.getElementById("chapterContent").value = "";

                        // Display success message or redirect if needed
                        alert("Chapter added successfully!");

                        // Note: The chapters will be loaded from the database, and the UI will be updated accordingly
                        loadChapterList(bookTitle);
                    }
                });
            } catch (error) {
                console.error("An unexpected error occurred:", error);
                alert("An unexpected error occurred. Please try again.");
            }
        }

        // Function to load chapter titles from the database and update the sidebar
        function loadChapterList(bookTitle) {
            const chapterListContainer = document.getElementById("chapterList");

            // Clear previous content
            chapterListContainer.innerHTML = "";

            // Fetch chapters from the database
            onValue(ref(db, `books/${bookTitle}/chapters`), (snapshot) => {
                const chapters = snapshot.val();

                if (chapters) {
                    Object.keys(chapters).forEach((key) => {
                        const chapter = chapters[key];

                        const listItem = document.createElement("li");
                        listItem.textContent = chapter.title;

                        // Add a click event listener to each chapter title
                        listItem.addEventListener("click", () => {
                            displayChapterContent(bookTitle, key);
                        });

                        chapterListContainer.appendChild(listItem);
                    });
                }
            });
        }

        // Function to display chapter content when a chapter title is clicked
        function displayChapterContent(bookTitle, chapterKey) {
            const contentDisplay = document.getElementById("contentDisplay");

            // Fetch the specific chapter from the database
            const chapterRef = ref(db, `books/${bookTitle}/chapters/${chapterKey}`);
            onValue(chapterRef, (snapshot) => {
                const chapter = snapshot.val();

                if (chapter) {
                    // Update the content display
                    contentDisplay.innerHTML = `<h3>${chapter.title}</h3><p>${chapter.content}</p>`;
                }
            });
        }

        // Initialize the chapter list on page load
        loadChapterList("Your_Book_Title");

        document.getElementById("addChapterBtn").addEventListener("click", function (event) {
            submitForm(event);
        });

    </script> -->
</body>

</html>
